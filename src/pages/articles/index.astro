---
import Base from "../../layouts/Base.astro";
import { getCollection } from "astro:content";

const items = await getCollection('articles', ({ data }) => !data.draft);
const sorted = items.sort((a,b) => new Date(b.data.date ?? b.data.pubDate ?? 0).getTime()
                                 - new Date(a.data.date ?? a.data.pubDate ?? 0).getTime());
---
<Base title="Artikel" description="Ausführliche Analysen & Longform-Inhalte.">
  <section style="padding:24px 0">
    <h1 style="margin:.4rem 0">Artikel</h1>
    <div class="grid" style="margin-top:12px">
      {sorted.map(({ data, slug }) => (
        <a class="card" href={`/articles/${slug}/`}>
          {data.cover && (
            <div class="cover">
              <img src={data.cover} alt={data.title} loading="lazy" />
            </div>
          )}
          <div class="p">
            <div class="meta">
              {new Date(data.date ?? data.pubDate ?? Date.now()).toLocaleDateString("de-DE", {
                year: "numeric", month: "short", day: "2-digit",
              })} · {data.readingTime ?? 12} Min
            </div>
            <div class="title">{data.title}</div>
            <div class="muted">{data.description}</div>
            <div style="margin-top:6px">
              {data.tags?.slice(0, 3).map((t) => <span class="tag">#{t}</span>)}
            </div>
          </div>
        </a>
      ))}
    </div>
  </section>
</Base>
